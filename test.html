<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Test - Property Inspection App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 { color: #2563eb; margin-bottom: 10px; }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
            font-weight: 500;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #1d4ed8; }
        .test-result { margin-top: 15px; }
        video { width: 100%; max-width: 400px; border-radius: 8px; }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>üî¨ Camera Test</h1>
        <p>This page tests if your device/browser supports the camera features needed for the Property Inspection App.</p>
        
        <button onclick="testCamera()">Test Camera Access</button>
        <button onclick="testWakeLock()">Test Wake Lock</button>
        <button onclick="testStorage()">Test Storage</button>
        <button onclick="window.location.href='index.html'">Open Main App ‚Üí</button>
        
        <div id="results"></div>
    </div>

    <div class="test-card">
        <h2>üìã Pre-Flight Checklist</h2>
        <div id="checklist">
            <p>‚úÖ <strong>HTTPS:</strong> <span id="httpsStatus">Checking...</span></p>
            <p>‚úÖ <strong>MediaDevices API:</strong> <span id="mediaStatus">Checking...</span></p>
            <p>‚úÖ <strong>Wake Lock API:</strong> <span id="wakeStatus">Checking...</span></p>
            <p>‚úÖ <strong>LocalStorage:</strong> <span id="storageStatus">Checking...</span></p>
            <p>‚úÖ <strong>JSZip Library:</strong> <span id="jszipStatus">Checking...</span></p>
        </div>
    </div>

    <script>
        // Check environment on load
        window.addEventListener('DOMContentLoaded', () => {
            // HTTPS check
            const isHttps = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
            document.getElementById('httpsStatus').textContent = isHttps ? 
                '‚úÖ Secure' : '‚ö†Ô∏è Camera requires HTTPS in production';
            
            // MediaDevices check
            const hasMedia = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
            document.getElementById('mediaStatus').textContent = hasMedia ? 
                '‚úÖ Supported' : '‚ùå Not supported';
            
            // Wake Lock check
            const hasWakeLock = 'wakeLock' in navigator;
            document.getElementById('wakeStatus').textContent = hasWakeLock ? 
                '‚úÖ Supported' : '‚ö†Ô∏è Not supported (optional)';
            
            // LocalStorage check
            const hasStorage = typeof(Storage) !== 'undefined';
            document.getElementById('storageStatus').textContent = hasStorage ? 
                '‚úÖ Supported' : '‚ùå Not supported';
            
            // JSZip check (needs to load from CDN)
            setTimeout(() => {
                const hasJSZip = typeof(JSZip) !== 'undefined';
                document.getElementById('jszipStatus').textContent = hasJSZip ? 
                    '‚úÖ Loaded' : '‚ö†Ô∏è Will load in main app';
            }, 1000);
        });

        async function testCamera() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="status warning">Requesting camera access...</div>';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                
                results.innerHTML = '<div class="status success">‚úÖ Camera access granted!</div>';
                results.innerHTML += '<video id="testVideo" autoplay playsinline></video>';
                document.getElementById('testVideo').srcObject = stream;
                
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    results.innerHTML += '<div class="test-result">Camera test complete. Stream stopped.</div>';
                }, 5000);
                
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Camera error: ${error.message}</div>`;
                results.innerHTML += '<div class="test-result">Make sure you granted camera permissions.</div>';
            }
        }

        async function testWakeLock() {
            const results = document.getElementById('results');
            
            if (!('wakeLock' in navigator)) {
                results.innerHTML = '<div class="status warning">‚ö†Ô∏è Wake Lock not supported on this device/browser</div>';
                results.innerHTML += '<div class="test-result">This is optional - the app will work without it.</div>';
                return;
            }
            
            try {
                const wakeLock = await navigator.wakeLock.request('screen');
                results.innerHTML = '<div class="status success">‚úÖ Wake Lock activated!</div>';
                results.innerHTML += '<div class="test-result">Screen will stay awake. Releasing in 5 seconds...</div>';
                
                setTimeout(() => {
                    wakeLock.release();
                    results.innerHTML += '<div class="test-result">Wake Lock released.</div>';
                }, 5000);
                
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå Wake Lock error: ${error.message}</div>`;
            }
        }

        function testStorage() {
            const results = document.getElementById('results');
            
            try {
                const testKey = 'test_storage_key';
                const testValue = 'test_value';
                
                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                if (retrieved === testValue) {
                    results.innerHTML = '<div class="status success">‚úÖ LocalStorage working perfectly!</div>';
                    results.innerHTML += '<div class="test-result">Settings will be saved between sessions.</div>';
                } else {
                    results.innerHTML = '<div class="status error">‚ùå LocalStorage test failed</div>';
                }
                
            } catch (error) {
                results.innerHTML = `<div class="status error">‚ùå LocalStorage error: ${error.message}</div>`;
                results.innerHTML += '<div class="test-result">Settings won\'t persist. Check browser privacy settings.</div>';
            }
        }
    </script>
</body>
</html>
